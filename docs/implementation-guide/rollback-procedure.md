# ë§¤ì¹­ ì—”ì§„ ë¡¤ë°± ì ˆì°¨ì„œ

## ê°œìš”

ì´ ë¬¸ì„œëŠ” ìƒ¤ë”©ëœ ë§¤ì¹­ ì—”ì§„ì˜ ë¡¤ë°± ì ˆì°¨ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ë°°í¬ ì‹¤íŒ¨, ì¥ì•  ë°œìƒ, ë˜ëŠ” ì˜ˆê¸°ì¹˜ ì•Šì€ ë™ì‘ ì‹œ ì‹ ì†í•˜ê²Œ ì´ì „ ìƒíƒœë¡œ ë³µêµ¬í•˜ê¸° ìœ„í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ëª©ì°¨

1. [ë¡¤ë°± ì‹œë‚˜ë¦¬ì˜¤ ë¶„ë¥˜](#ë¡¤ë°±-ì‹œë‚˜ë¦¬ì˜¤-ë¶„ë¥˜)
2. [ì‚¬ì „ ì¤€ë¹„ì‚¬í•­](#ì‚¬ì „-ì¤€ë¹„ì‚¬í•­)
3. [ë¡¤ë°± ì ˆì°¨](#ë¡¤ë°±-ì ˆì°¨)
4. [ìƒ¤ë“œë³„ ë¡¤ë°±](#ìƒ¤ë“œë³„-ë¡¤ë°±)
5. [ê¸´ê¸‰ ë¡¤ë°±](#ê¸´ê¸‰-ë¡¤ë°±)
6. [ë¡¤ë°± í›„ ê²€ì¦](#ë¡¤ë°±-í›„-ê²€ì¦)
7. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## ë¡¤ë°± ì‹œë‚˜ë¦¬ì˜¤ ë¶„ë¥˜

### Level 1: ë‹¨ìˆœ ë°°í¬ ë¡¤ë°±
- **ìƒí™©**: ìƒˆ ë²„ì „ ë°°í¬ í›„ ë²„ê·¸ ë°œê²¬
- **ì˜í–¥**: íŠ¹ì • ê¸°ëŠ¥ ì˜¤ì‘ë™
- **ì¡°ì¹˜**: Kubernetes ë¡¤ë°±
- **ì†Œìš”ì‹œê°„**: 5-10ë¶„

### Level 2: ìƒ¤ë“œ ë‹¨ìœ„ ë¡¤ë°±
- **ìƒí™©**: íŠ¹ì • ìƒ¤ë“œì—ì„œë§Œ ë¬¸ì œ ë°œìƒ
- **ì˜í–¥**: í•´ë‹¹ ìƒ¤ë“œì˜ ì‹¬ë³¼ë§Œ ì˜í–¥
- **ì¡°ì¹˜**: í•´ë‹¹ ìƒ¤ë“œë§Œ ë¡¤ë°±
- **ì†Œìš”ì‹œê°„**: 10-15ë¶„

### Level 3: ì „ì²´ ì‹œìŠ¤í…œ ë¡¤ë°±
- **ìƒí™©**: ì „ì²´ ë§¤ì¹­ ì—”ì§„ ì¥ì• 
- **ì˜í–¥**: ëª¨ë“  ê±°ë˜ ì¤‘ë‹¨
- **ì¡°ì¹˜**: ì „ì²´ ë¡¤ë°± + ìƒíƒœ ë³µêµ¬
- **ì†Œìš”ì‹œê°„**: 30-60ë¶„

### Level 4: ê¸´ê¸‰ ë³µêµ¬ (ì¬í•´ ë³µêµ¬)
- **ìƒí™©**: ë°ì´í„° ì†ìƒ, ì¸í”„ë¼ ì¥ì• 
- **ì˜í–¥**: ì „ì²´ ì‹œìŠ¤í…œ ë¶ˆê°€
- **ì¡°ì¹˜**: DR ì‚¬ì´íŠ¸ ì „í™˜ ë˜ëŠ” ë°±ì—… ë³µêµ¬
- **ì†Œìš”ì‹œê°„**: 1-4ì‹œê°„

---

## ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

### 1. ë¡¤ë°± ì²´í¬ë¦¬ìŠ¤íŠ¸

```
â–¡ ì´ì „ ë²„ì „ ì´ë¯¸ì§€ íƒœê·¸ í™•ì¸
â–¡ í˜„ì¬ ìƒíƒœ ìŠ¤ëƒ…ìƒ· ìƒì„±
â–¡ Kafka consumer offset ê¸°ë¡
â–¡ í™œì„± ì£¼ë¬¸ ìˆ˜ í™•ì¸
â–¡ ë¡¤ë°± ë‹´ë‹¹ì ì§€ì •
â–¡ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ì±„ë„ ì¤€ë¹„ (Slack, PagerDuty)
```

### 2. í•„ìˆ˜ ì •ë³´ ìˆ˜ì§‘

```bash
# í˜„ì¬ ë°°í¬ ìƒíƒœ í™•ì¸
kubectl get statefulset -n matching-engine -o wide
kubectl get pods -n matching-engine -o wide

# í˜„ì¬ ì´ë¯¸ì§€ ë²„ì „ í™•ì¸
kubectl get statefulset matching-engine-shard-1 -n matching-engine \
  -o jsonpath='{.spec.template.spec.containers[0].image}'

# Revision íˆìŠ¤í† ë¦¬ í™•ì¸
kubectl rollout history statefulset/matching-engine-shard-1 -n matching-engine

# í™œì„± ì£¼ë¬¸ ìˆ˜ í™•ì¸ (Prometheus)
curl -s "http://prometheus:9090/api/v1/query?query=sum(matching_engine_active_orders_total)" | jq
```

### 3. ë¡¤ë°± ëŒ€ìƒ ë²„ì „ ê²°ì •

```bash
# ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë¯¸ì§€ íƒœê·¸ ëª©ë¡
aws ecr describe-images \
  --repository-name exchange/matching-engine-shard \
  --query 'imageDetails[*].imageTags' \
  --output table

# ìµœê·¼ ë°°í¬ ì´ë ¥ (ë§ˆì§€ë§‰ 5ê°œ)
kubectl rollout history statefulset/matching-engine-shard-1 -n matching-engine --revision=5
```

---

## ë¡¤ë°± ì ˆì°¨

### Level 1: Kubernetes ë¡¤ë°± (ê¶Œì¥)

#### Step 1: ë¡¤ë°± ì „ ìƒíƒœ ì €ì¥

```bash
#!/bin/bash
# save-state-before-rollback.sh

TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/tmp/rollback-backup-${TIMESTAMP}"
mkdir -p ${BACKUP_DIR}

# í˜„ì¬ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì €ì¥
for shard in 1 2 3; do
  kubectl get statefulset matching-engine-shard-${shard} -n matching-engine -o yaml \
    > ${BACKUP_DIR}/shard-${shard}-statefulset.yaml
done

# Pod ìƒíƒœ ì €ì¥
kubectl get pods -n matching-engine -o wide > ${BACKUP_DIR}/pods-status.txt

# ë©”íŠ¸ë¦­ ìŠ¤ëƒ…ìƒ·
curl -s "http://prometheus:9090/api/v1/query?query=matching_engine_active_orders_total" \
  > ${BACKUP_DIR}/active-orders.json

echo "Backup saved to: ${BACKUP_DIR}"
```

#### Step 2: íŠ¸ë˜í”½ ì°¨ë‹¨ (ì„ íƒì )

```bash
# ìƒˆ ì£¼ë¬¸ ì¼ì‹œ ì¤‘ì§€ (Backendì—ì„œ ì²˜ë¦¬)
kubectl annotate service matching-engine -n matching-engine \
  traffic.sidecar.istio.io/excludeInboundPorts="8080"

# ë˜ëŠ” HPA ë¹„í™œì„±í™”
kubectl patch hpa matching-engine-shard-1 -n matching-engine \
  -p '{"spec":{"minReplicas":0,"maxReplicas":0}}'
```

#### Step 3: ë¡¤ë°± ì‹¤í–‰

```bash
# ë°©ë²• 1: ì´ì „ ë¦¬ë¹„ì „ìœ¼ë¡œ ë¡¤ë°±
kubectl rollout undo statefulset/matching-engine-shard-1 -n matching-engine
kubectl rollout undo statefulset/matching-engine-shard-2 -n matching-engine
kubectl rollout undo statefulset/matching-engine-shard-3 -n matching-engine

# ë°©ë²• 2: íŠ¹ì • ë¦¬ë¹„ì „ìœ¼ë¡œ ë¡¤ë°±
kubectl rollout undo statefulset/matching-engine-shard-1 -n matching-engine --to-revision=3

# ë°©ë²• 3: íŠ¹ì • ì´ë¯¸ì§€ë¡œ ë¡¤ë°±
kubectl set image statefulset/matching-engine-shard-1 \
  matching-engine=exchange/matching-engine-shard:v1.2.0 \
  -n matching-engine
```

#### Step 4: ë¡¤ë°± ìƒíƒœ ëª¨ë‹ˆí„°ë§

```bash
# ë¡¤ë°± ì§„í–‰ ìƒí™© í™•ì¸
kubectl rollout status statefulset/matching-engine-shard-1 -n matching-engine --timeout=300s

# Pod ìƒíƒœ í™•ì¸
watch -n 2 'kubectl get pods -n matching-engine -l app.kubernetes.io/name=matching-engine'

# ë¡œê·¸ í™•ì¸
kubectl logs -f statefulset/matching-engine-shard-1 -n matching-engine --tail=100
```

#### Step 5: íŠ¸ë˜í”½ ë³µêµ¬

```bash
# íŠ¸ë˜í”½ ì¬ê°œ
kubectl annotate service matching-engine -n matching-engine \
  traffic.sidecar.istio.io/excludeInboundPorts-

# Health check í™•ì¸
for shard in 1 2 3; do
  POD=$(kubectl get pod -n matching-engine -l app.kubernetes.io/component=shard-${shard} -o jsonpath='{.items[0].metadata.name}')
  kubectl exec -n matching-engine ${POD} -- curl -s http://localhost:8080/health/ready
  echo ""
done
```

---

## ìƒ¤ë“œë³„ ë¡¤ë°±

### íŠ¹ì • ìƒ¤ë“œë§Œ ë¡¤ë°±

íŠ¹ì • ìƒ¤ë“œì—ì„œë§Œ ë¬¸ì œê°€ ë°œìƒí•œ ê²½ìš°, í•´ë‹¹ ìƒ¤ë“œë§Œ ë¡¤ë°±í•©ë‹ˆë‹¤.

```bash
#!/bin/bash
# rollback-single-shard.sh

SHARD_ID=${1:-1}
TARGET_REVISION=${2:-""}

echo "=== Rolling back Shard ${SHARD_ID} ==="

# 1. í•´ë‹¹ ìƒ¤ë“œì˜ ì‹¬ë³¼ ì¼ì‹œ ì¤‘ì§€
SYMBOLS=$(kubectl get configmap matching-engine-config -n matching-engine \
  -o jsonpath='{.data.shard-mapping\.yaml}' | yq ".shards.shard-${SHARD_ID}.symbols[]")

echo "Pausing symbols: ${SYMBOLS}"
# API í˜¸ì¶œë¡œ ì‹¬ë³¼ ì¼ì‹œ ì¤‘ì§€ (Backendì—ì„œ êµ¬í˜„ í•„ìš”)
# curl -X POST "http://backend/api/admin/symbols/pause" -d "{\"symbols\": ${SYMBOLS}}"

# 2. ë¡¤ë°± ì‹¤í–‰
if [ -z "$TARGET_REVISION" ]; then
  kubectl rollout undo statefulset/matching-engine-shard-${SHARD_ID} -n matching-engine
else
  kubectl rollout undo statefulset/matching-engine-shard-${SHARD_ID} -n matching-engine \
    --to-revision=${TARGET_REVISION}
fi

# 3. ë¡¤ë°± ì™„ë£Œ ëŒ€ê¸°
kubectl rollout status statefulset/matching-engine-shard-${SHARD_ID} -n matching-engine \
  --timeout=300s

# 4. Health check
sleep 10
kubectl exec -n matching-engine matching-engine-shard-${SHARD_ID}-0 -- \
  curl -s http://localhost:8080/health/ready

# 5. ì‹¬ë³¼ ì¬ê°œ
echo "Resuming symbols..."
# curl -X POST "http://backend/api/admin/symbols/resume" -d "{\"symbols\": ${SYMBOLS}}"

echo "=== Shard ${SHARD_ID} rollback completed ==="
```

### ìƒ¤ë“œ ê°„ ë¶ˆì¼ì¹˜ í•´ê²°

ìƒ¤ë“œ ê°„ ë²„ì „ ë¶ˆì¼ì¹˜ ì‹œ ë™ê¸°í™”:

```bash
# ëª¨ë“  ìƒ¤ë“œë¥¼ ë™ì¼ ë²„ì „ìœ¼ë¡œ í†µì¼
TARGET_IMAGE="exchange/matching-engine-shard:v1.2.0"

for shard in 1 2 3; do
  kubectl set image statefulset/matching-engine-shard-${shard} \
    matching-engine=${TARGET_IMAGE} \
    -n matching-engine
done

# ìˆœì°¨ì  ë¡¤ì•„ì›ƒ í™•ì¸
for shard in 1 2 3; do
  echo "Waiting for shard-${shard}..."
  kubectl rollout status statefulset/matching-engine-shard-${shard} -n matching-engine
done
```

---

## ê¸´ê¸‰ ë¡¤ë°±

### ê¸´ê¸‰ ìƒí™© íŒë‹¨ ê¸°ì¤€

| ì§€í‘œ | ì„ê³„ê°’ | ì¡°ì¹˜ |
|-----|-------|-----|
| ì£¼ë¬¸ ì²˜ë¦¬ëŸ‰ | 0 (5ë¶„ ì´ìƒ) | ì¦‰ì‹œ ë¡¤ë°± |
| ì—ëŸ¬ìœ¨ | 50% ì´ìƒ | ì¦‰ì‹œ ë¡¤ë°± |
| P99 ì§€ì—° | 5ì´ˆ ì´ìƒ | ì¦‰ì‹œ ë¡¤ë°± |
| ë©”ëª¨ë¦¬ ì‚¬ìš© | 99% ì´ìƒ | ì¦‰ì‹œ ë¡¤ë°± |
| Pod Crash | 3íšŒ ì´ìƒ/ë¶„ | ì¦‰ì‹œ ë¡¤ë°± |

### ê¸´ê¸‰ ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# emergency-rollback.sh
# ì‚¬ìš©ë²•: ./emergency-rollback.sh [target-version]

set -e

TARGET_VERSION=${1:-"previous"}
NAMESPACE="matching-engine"
SLACK_WEBHOOK="${SLACK_WEBHOOK_URL}"

# ì•Œë¦¼ í•¨ìˆ˜
notify() {
  local message=$1
  local severity=${2:-"info"}

  echo "[$(date '+%Y-%m-%d %H:%M:%S')] ${message}"

  if [ -n "$SLACK_WEBHOOK" ]; then
    curl -s -X POST -H 'Content-type: application/json' \
      --data "{\"text\":\"[${severity^^}] Matching Engine: ${message}\"}" \
      ${SLACK_WEBHOOK}
  fi
}

# 1. ê¸´ê¸‰ ì•Œë¦¼
notify "ğŸš¨ Emergency rollback initiated" "critical"

# 2. í˜„ì¬ ìƒíƒœ ê¸°ë¡
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
kubectl get all -n ${NAMESPACE} > /tmp/emergency-state-${TIMESTAMP}.txt

# 3. ëª¨ë“  ìƒ¤ë“œ ë™ì‹œ ë¡¤ë°±
notify "Rolling back all shards..."

if [ "$TARGET_VERSION" == "previous" ]; then
  # ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
  kubectl rollout undo statefulset/matching-engine-shard-1 -n ${NAMESPACE} &
  kubectl rollout undo statefulset/matching-engine-shard-2 -n ${NAMESPACE} &
  kubectl rollout undo statefulset/matching-engine-shard-3 -n ${NAMESPACE} &
else
  # íŠ¹ì • ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
  IMAGE="exchange/matching-engine-shard:${TARGET_VERSION}"
  kubectl set image statefulset/matching-engine-shard-1 matching-engine=${IMAGE} -n ${NAMESPACE} &
  kubectl set image statefulset/matching-engine-shard-2 matching-engine=${IMAGE} -n ${NAMESPACE} &
  kubectl set image statefulset/matching-engine-shard-3 matching-engine=${IMAGE} -n ${NAMESPACE} &
fi

wait

# 4. ë¡¤ë°± ì™„ë£Œ ëŒ€ê¸°
notify "Waiting for rollback to complete..."

for shard in 1 2 3; do
  kubectl rollout status statefulset/matching-engine-shard-${shard} -n ${NAMESPACE} \
    --timeout=300s || {
      notify "Shard ${shard} rollback timeout!" "critical"
      exit 1
    }
done

# 5. Health í™•ì¸
sleep 15
HEALTHY=0
for shard in 1 2 3; do
  POD="matching-engine-shard-${shard}-0"
  if kubectl exec -n ${NAMESPACE} ${POD} -- curl -sf http://localhost:8080/health/ready > /dev/null; then
    HEALTHY=$((HEALTHY + 1))
  fi
done

if [ $HEALTHY -eq 3 ]; then
  notify "âœ… Emergency rollback completed successfully. All 3 shards healthy." "info"
else
  notify "âš ï¸ Rollback completed but only ${HEALTHY}/3 shards healthy!" "warning"
fi

# 6. ë©”íŠ¸ë¦­ í™•ì¸
echo ""
echo "=== Post-rollback Status ==="
kubectl get pods -n ${NAMESPACE} -o wide
```

### ê¸´ê¸‰ ì •ì§€ (Kill Switch)

ëª¨ë“  ê±°ë˜ë¥¼ ì¦‰ì‹œ ì¤‘ë‹¨í•´ì•¼ í•˜ëŠ” ê²½ìš°:

```bash
#!/bin/bash
# kill-switch.sh - ëª¨ë“  ë§¤ì¹­ ì—”ì§„ ì¦‰ì‹œ ì¤‘ë‹¨

NAMESPACE="matching-engine"

echo "âš ï¸  WARNING: This will stop ALL trading immediately!"
read -p "Type 'STOP ALL TRADING' to confirm: " CONFIRM

if [ "$CONFIRM" != "STOP ALL TRADING" ]; then
  echo "Aborted."
  exit 1
fi

# 1. ëª¨ë“  StatefulSet ìŠ¤ì¼€ì¼ ë‹¤ìš´
kubectl scale statefulset --all -n ${NAMESPACE} --replicas=0

# 2. í™•ì¸
kubectl get pods -n ${NAMESPACE}

echo ""
echo "All matching engines stopped."
echo "To restore: kubectl scale statefulset --all -n ${NAMESPACE} --replicas=2"
```

---

## ë¡¤ë°± í›„ ê²€ì¦

### 1. ê¸°ë³¸ ìƒíƒœ í™•ì¸

```bash
#!/bin/bash
# verify-rollback.sh

NAMESPACE="matching-engine"

echo "=== 1. Pod Status ==="
kubectl get pods -n ${NAMESPACE} -o wide

echo ""
echo "=== 2. Version Check ==="
for shard in 1 2 3; do
  VERSION=$(kubectl get statefulset matching-engine-shard-${shard} -n ${NAMESPACE} \
    -o jsonpath='{.spec.template.spec.containers[0].image}')
  echo "Shard ${shard}: ${VERSION}"
done

echo ""
echo "=== 3. Health Status ==="
for shard in 1 2 3; do
  POD="matching-engine-shard-${shard}-0"
  echo -n "Shard ${shard}: "
  kubectl exec -n ${NAMESPACE} ${POD} -- curl -sf http://localhost:8080/health 2>/dev/null || echo "UNHEALTHY"
done

echo ""
echo "=== 4. Recent Errors ==="
kubectl logs -n ${NAMESPACE} -l app.kubernetes.io/name=matching-engine \
  --since=5m --tail=50 | grep -i "error\|exception" | tail -10

echo ""
echo "=== 5. Metrics Check ==="
# ì£¼ë¬¸ ì²˜ë¦¬ëŸ‰
echo -n "Orders/sec: "
curl -sf "http://prometheus:9090/api/v1/query?query=sum(rate(matching_engine_orders_processed_total[1m]))" \
  | jq -r '.data.result[0].value[1] // "N/A"'

# í™œì„± ì£¼ë¬¸ ìˆ˜
echo -n "Active Orders: "
curl -sf "http://prometheus:9090/api/v1/query?query=sum(matching_engine_active_orders_total)" \
  | jq -r '.data.result[0].value[1] // "N/A"'
```

### 2. ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

```bash
# í…ŒìŠ¤íŠ¸ ì£¼ë¬¸ ì „ì†¡ (Staging/Dev í™˜ê²½ì—ì„œë§Œ)
curl -X POST "http://backend/api/v1/orders/test" \
  -H "Content-Type: application/json" \
  -d '{
    "symbol": "BTCUSDT",
    "side": "BUY",
    "type": "LIMIT",
    "quantity": "0.001",
    "price": "50000"
  }'
```

### 3. ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

```
â–¡ ëª¨ë“  Pod Running ìƒíƒœ
â–¡ Health endpoint ì‘ë‹µ ì •ìƒ
â–¡ ì£¼ë¬¸ ì²˜ë¦¬ëŸ‰ ì •ìƒ ë²”ìœ„
â–¡ ì—ëŸ¬ ë¡œê·¸ ì—†ìŒ
â–¡ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì•ˆì •
â–¡ Kafka consumer lag ì •ìƒ
â–¡ Grafana ëŒ€ì‹œë³´ë“œ ì •ìƒ
â–¡ í…ŒìŠ¤íŠ¸ ì£¼ë¬¸ ì„±ê³µ (í•´ë‹¹ ì‹œ)
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ë¡¤ë°±ì´ ì§„í–‰ë˜ì§€ ì•ŠìŒ

```bash
# ì›ì¸ í™•ì¸
kubectl describe statefulset matching-engine-shard-1 -n matching-engine
kubectl get events -n matching-engine --sort-by='.lastTimestamp' | tail -20

# í•´ê²°: Pod ê°•ì œ ì‚­ì œ í›„ ì¬ìƒì„±
kubectl delete pod matching-engine-shard-1-0 -n matching-engine --force --grace-period=0
```

### ë¬¸ì œ 2: ë¡¤ë°± í›„ì—ë„ ì˜¤ë¥˜ ì§€ì†

```bash
# ë” ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
kubectl rollout history statefulset/matching-engine-shard-1 -n matching-engine
kubectl rollout undo statefulset/matching-engine-shard-1 -n matching-engine --to-revision=2

# ë˜ëŠ” ì•Œë ¤ì§„ ì•ˆì • ë²„ì „ìœ¼ë¡œ ì§ì ‘ ì§€ì •
kubectl set image statefulset/matching-engine-shard-1 \
  matching-engine=exchange/matching-engine-shard:v1.0.0-stable \
  -n matching-engine
```

### ë¬¸ì œ 3: Kafka Consumer Lag ì¦ê°€

```bash
# Consumer ìƒíƒœ í™•ì¸
kafka-consumer-groups.sh --bootstrap-server kafka:9092 \
  --group matching-engine-shard-1 --describe

# ì˜¤í”„ì…‹ ë¦¬ì…‹ (ì£¼ì˜: ë°ì´í„° ìœ ì‹¤ ê°€ëŠ¥)
kafka-consumer-groups.sh --bootstrap-server kafka:9092 \
  --group matching-engine-shard-1 \
  --topic matching-engine-shard-1-input \
  --reset-offsets --to-latest --execute
```

### ë¬¸ì œ 4: PVC ë§ˆìš´íŠ¸ ì‹¤íŒ¨

```bash
# PVC ìƒíƒœ í™•ì¸
kubectl get pvc -n matching-engine

# PVC ì¬ìƒì„± í•„ìš”ì‹œ
kubectl delete pvc logs-matching-engine-shard-1-0 -n matching-engine
# Podê°€ ë‹¤ì‹œ ì‹œì‘ë˜ë©´ ìƒˆ PVC ìƒì„±ë¨
```

### ë¬¸ì œ 5: Primary/Standby ì—­í•  í˜¼ë€

```bash
# Pod ë¼ë²¨ í™•ì¸
kubectl get pods -n matching-engine -L role

# ê°•ì œë¡œ ì—­í•  ì¬í• ë‹¹ (Pod ì¬ì‹œì‘ìœ¼ë¡œ)
kubectl delete pod matching-engine-shard-1-0 -n matching-engine
kubectl delete pod matching-engine-shard-1-1 -n matching-engine
# Pod-0ì´ Primary, Pod-1ì´ Standbyë¡œ ì¬ì‹œì‘ë¨
```

---

## ë¡¤ë°± ì´ë ¥ ê´€ë¦¬

### ë¡¤ë°± ê¸°ë¡ í…œí”Œë¦¿

```markdown
## ë¡¤ë°± ê¸°ë¡

| ë‚ ì§œ | ë‹´ë‹¹ì | ìƒ¤ë“œ | ì´ì „ ë²„ì „ | ë¡¤ë°± ë²„ì „ | ì›ì¸ | ì†Œìš”ì‹œê°„ |
|-----|-------|-----|---------|---------|-----|--------|
| 2024-01-15 14:30 | í™ê¸¸ë™ | ì „ì²´ | v1.3.0 | v1.2.5 | ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ | 15ë¶„ |
| 2024-01-10 09:15 | ê¹€ì² ìˆ˜ | shard-1 | v1.2.5 | v1.2.4 | BTC ì£¼ë¬¸ ì²˜ë¦¬ ì˜¤ë¥˜ | 8ë¶„ |
```

### ì‚¬í›„ ë¶„ì„ (Post-mortem)

ë¡¤ë°± í›„ ë°˜ë“œì‹œ ì‚¬í›„ ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

1. **ê·¼ë³¸ ì›ì¸ ë¶„ì„**: ì™œ ë¡¤ë°±ì´ í•„ìš”í–ˆëŠ”ê°€?
2. **ì˜í–¥ ë²”ìœ„**: ì–¼ë§ˆë‚˜ ë§ì€ ì‚¬ìš©ì/ê±°ë˜ê°€ ì˜í–¥ë°›ì•˜ëŠ”ê°€?
3. **íƒì§€ ì‹œê°„**: ë¬¸ì œ ë°œìƒë¶€í„° íƒì§€ê¹Œì§€ ì–¼ë§ˆë‚˜ ê±¸ë ¸ëŠ”ê°€?
4. **ë³µêµ¬ ì‹œê°„**: íƒì§€ë¶€í„° ë³µêµ¬ê¹Œì§€ ì–¼ë§ˆë‚˜ ê±¸ë ¸ëŠ”ê°€?
5. **ì¬ë°œ ë°©ì§€**: ì–´ë–»ê²Œ í•˜ë©´ ê°™ì€ ë¬¸ì œë¥¼ ë°©ì§€í•  ìˆ˜ ìˆëŠ”ê°€?

---

## ì—°ë½ì²˜

| ì—­í•  | ë‹´ë‹¹ì | ì—°ë½ì²˜ |
|-----|-------|-------|
| ë§¤ì¹­ì—”ì§„ Lead | - | Slack: @matching-engine-lead |
| SRE ë‹¹ì§ | - | PagerDuty: exchange-sre |
| ì¸í”„ë¼íŒ€ | - | Slack: @infra-oncall |

---

*ìµœì¢… ìˆ˜ì •ì¼: 2024-01-16*
*ë¬¸ì„œ ë²„ì „: 1.0*
